<!-- ... head ... -->
<!-- Firebase CDN скрипты -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCptJ1iTweRdZE3hxaepb6Wx2rdhTCYfDo",
  authDomain: "bba-creator.firebaseapp.com",
  projectId: "bba-creator",
  storageBucket: "bba-creator.appspot.com",
  messagingSenderId: "141640866350",
  appId: "1:141640866350:web:bca3f1d2278165837e1dbf",
  measurementId: "G-FEKG0B970P"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
let currentUser = null;

// Проверка входа пользователя
firebase.auth().onAuthStateChanged(function(user) {
  if (!user) {
    window.location.href = "auth.html";
  } else {
    currentUser = user;
  }
});

// Анализ рациона и сохранение
function analyzeFood() {
  const text = document.getElementById('foodText').value.trim();
  const photo = document.getElementById('foodPhoto').files[0];
  let result = "";

  if (!text && !photo) {
    result = '<span style="color:#e53935;">Пожалуйста, введите рацион или загрузите фото.</span>';
  } else if (text) {
    result = `
      <b>Пример анализа рациона:</b><br>
      - Калорийность: ~1650 ккал<br>
      - Белки: ~90 г, Жиры: ~50 г, Углеводы: ~220 г<br>
      <span style="color:#bfa800">Рекомендация:</span> Чуть увеличить белки на ужин, добавить листовые овощи, снизить сладкое.<br>
      <span style="font-size:0.93em; color:#888">В будущем здесь появится детальный анализ из AI по вашему тексту или фото.</span>
    `;
    // Сохраняем текст анализа в Firestore (фото — позже)
    if (currentUser) {
      db.collection('users').doc(currentUser.uid).collection('analyzes').add({
        date: new Date().toISOString(),
        foodText: text,
        analysis: result
      });
    }
  } else if (photo) {
    result = "<b>Анализ фото пока в разработке (экспериментально)</b>";
    // Фото-сохранение позже (через Firebase Storage)
  }
  document.getElementById('analysisResult').innerHTML = result;
}

const toggle = document.getElementById('themeToggle');
toggle.addEventListener('change', () => {
  document.body.classList.toggle('futurism');
});
</script>
