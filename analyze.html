<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>NutriAxis — Анализ рациона</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    <h1>NutriAxis</h1>
    <nav>
      <a href="index.html">Калькулятор</a> |
      <a href="analyze.html">Анализ рациона</a> |
      <a href="profile.html">Личный кабинет</a>
      <button onclick="logout()" style="float:right;">Выйти</button>
    </nav>
    <label class="theme-toggle">
      <input type="checkbox" id="themeToggle" />
      <span>Сменить стиль</span>
    </label>
  </header>
  <main>
    <section class="analyzer">
      <h2>Анализируй свой рацион</h2>
      <form id="foodForm">
        <label>
          Введите свой рацион за день:
          <textarea id="foodText" rows="4" placeholder="Например: Завтрак: овсянка, банан..."></textarea>
        </label>
        <label>
          <span>Загрузить фото (экспериментально):</span>
          <input type="file" id="foodPhoto" accept="image/*">
        </label>
        <button type="button" onclick="analyzeFood()">Анализировать</button>
      </form>
      <div id="analysisResult"></div>
    </section>
  </main>
  <footer>
    <a href="/legal/disclaimer.html">Отказ от ответственности</a> |
    <a href="/legal/privacy.html">Политика конфиденциальности</a> |
    <a href="/legal/terms.html">Условия использования</a>
  </footer>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCptJ1iTweRdZE3hxaepb6Wx2rdhTCYfDo",
      authDomain: "bba-creator.firebaseapp.com",
      projectId: "bba-creator",
      storageBucket: "bba-creator.appspot.com",
      messagingSenderId: "141640866350",
      appId: "1:141640866350:web:bca3f1d2278165837e1dbf",
      measurementId: "G-FEKG0B970P"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    firebase.auth().onAuthStateChanged(user => {
      if (!user) window.location.href = "auth.html";
    });

    function analyzeFood() {
      const text = document.getElementById('foodText').value;
      const photo = document.getElementById('foodPhoto').files[0];
      let result = "<b>Анализ ещё не подключён.</b> Здесь появится разбор по калориям, макро- и микронутриентам.<br>Для загрузки фото — скоро!";
      document.getElementById('analysisResult').innerHTML = result;

      // --- Firestore: сохранение анализа ---
      const user = firebase.auth().currentUser;
      if (user) {
        db.collection('users').doc(user.uid).collection('analyzes').add({
          foodText: text,
          photoName: photo ? photo.name : "",
          date: new Date().toISOString()
        });
      }
    }
    function logout() {
      firebase.auth().signOut().then(() => window.location.href = "auth.html");
    }
    // Переключение темы
    document.getElementById('themeToggle').addEventListener('change', () => {
      document.body.classList.toggle('futurism');
    });
  </script>
</body>
</html>
